<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Skill Gap Analyzer - All Features</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #2c3e50; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #7f8c8d; font-size: 1.2em; }
        
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .feature-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 4px solid #3498db; }
        .feature-card h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.3em; }
        .feature-card input, .feature-card select, .feature-card textarea { width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
        .feature-card button { background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .feature-card button:hover { background: #2980b9; transform: translateY(-2px); }
        .feature-card button:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; }
        
        .results { background: white; border-radius: 12px; padding: 25px; margin-top: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .results h3 { color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }
        .score-display { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .score-circle { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; }
        .score-excellent { background: #27ae60; }
        .score-good { background: #f39c12; }
        .score-average { background: #e67e22; }
        .score-poor { background: #e74c3c; }
        
        .skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .skill-category { background: #ecf0f1; padding: 15px; border-radius: 8px; }
        .skill-category h4 { color: #2c3e50; margin-bottom: 10px; }
        .skill-tag { display: inline-block; background: #3498db; color: white; padding: 4px 8px; border-radius: 4px; margin: 2px; font-size: 12px; }
        .skill-tag.missing { background: #e74c3c; }
        .skill-tag.matched { background: #27ae60; }
        
        .loading { text-align: center; padding: 40px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .quick-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .quick-btn { background: #2ecc71; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .quick-btn:hover { background: #27ae60; }
        
        .role-matches { margin-top: 20px; }
        .role-match { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #3498db; }
        .role-match h4 { color: #2c3e50; margin-bottom: 5px; }
        .role-match .score { font-weight: bold; color: #3498db; }
        
        .suggestions { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-top: 20px; }
        .suggestions h4 { color: #856404; margin-bottom: 10px; }
        .suggestions ul { list-style: none; }
        .suggestions li { margin-bottom: 8px; padding-left: 20px; position: relative; }
        .suggestions li:before { content: "üí°"; position: absolute; left: 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Quick Skill Gap Analyzer</h1>
            <p>All ATS Features in One Place - Fast & Comprehensive</p>
        </div>

        <div class="feature-grid">
            <!-- Feature 1: Quick Skill Input -->
            <div class="feature-card">
                <h3>üéØ 1. Enter Your Skills</h3>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="loadSampleSkills('developer')">Web Developer</button>
                    <button class="quick-btn" onclick="loadSampleSkills('data')">Data Scientist</button>
                    <button class="quick-btn" onclick="loadSampleSkills('devops')">DevOps Engineer</button>
                    <button class="quick-btn" onclick="loadSampleSkills('mobile')">Mobile Developer</button>
                </div>
                <textarea id="userSkills" placeholder="Enter your skills separated by commas (e.g., Python, React, AWS, SQL, Docker)" rows="4"></textarea>
                <input type="number" id="experienceYears" placeholder="Years of Experience" min="0" max="20" step="0.5">
                <button onclick="analyzeAllFeatures()" id="analyzeBtn">üß† Analyze All Features</button>
            </div>

            <!-- Feature 2: Target Role Selection -->
            <div class="feature-card">
                <h3>üéØ 2. Select Target Role</h3>
                <select id="targetRole">
                    <option value="">Select a role for detailed analysis</option>
                </select>
                <button onclick="loadRoles()" id="loadRolesBtn">üìã Load Available Roles</button>
                <button onclick="analyzeSpecificRole()" id="roleAnalyzeBtn" disabled>üîç Analyze Role Gap</button>
            </div>

            <!-- Feature 3: Resume Upload (Optional) -->
            <div class="feature-card">
                <h3>üìÑ 3. Upload Resume (Optional)</h3>
                <input type="file" id="resumeFile" accept=".pdf,.docx,.txt">
                <button onclick="uploadAndAnalyze()" id="uploadBtn">üì§ Upload & Analyze</button>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">
                    Upload to auto-extract skills, or use manual entry above
                </p>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="results" style="display: none;">
            <h3>üìä Comprehensive Analysis Results</h3>
            <div id="resultsContent"></div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing with AI... Please wait</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let authToken = null;

        // Sample skill sets for quick testing
        const sampleSkills = {
            developer: "JavaScript, React, Node.js, Python, HTML, CSS, Git, MongoDB, Express, REST APIs",
            data: "Python, SQL, Pandas, NumPy, Scikit-learn, TensorFlow, Jupyter, Statistics, Machine Learning, Data Visualization",
            devops: "Docker, Kubernetes, AWS, Jenkins, Git, Linux, Terraform, Ansible, CI/CD, Monitoring",
            mobile: "React Native, Flutter, Android, iOS, Swift, Kotlin, Firebase, Mobile UI/UX, App Store"
        };

        function loadSampleSkills(type) {
            document.getElementById('userSkills').value = sampleSkills[type];
            document.getElementById('experienceYears').value = type === 'data' ? '3' : '2';
        }

        async function authenticateUser() {
            if (authToken) return authToken;
            
            try {
                const timestamp = Date.now();
                const response = await fetch(`${API_BASE}/api/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: `Quick Test User ${timestamp}`,
                        email: `quicktest${timestamp}@example.com`,
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                authToken = data.access_token;
                return authToken;
            } catch (error) {
                console.error('Auth failed:', error);
                return null;
            }
        }

        async function loadRoles() {
            const btn = document.getElementById('loadRolesBtn');
            btn.disabled = true;
            btn.textContent = 'Loading...';
            
            try {
                const token = await authenticateUser();
                const response = await fetch(`${API_BASE}/api/resume/dataset-roles`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                const select = document.getElementById('targetRole');
                select.innerHTML = '<option value="">Select a role for detailed analysis</option>';
                
                data.roles.slice(0, 50).forEach(role => {
                    const option = document.createElement('option');
                    option.value = role.title;
                    option.textContent = `${role.title} (${role.job_count} jobs)`;
                    select.appendChild(option);
                });
                
                document.getElementById('roleAnalyzeBtn').disabled = false;
                btn.textContent = '‚úÖ Roles Loaded';
            } catch (error) {
                console.error('Failed to load roles:', error);
                btn.textContent = '‚ùå Failed to Load';
            }
        }

        async function analyzeAllFeatures() {
            const skills = document.getElementById('userSkills').value.trim();
            if (!skills) {
                alert('Please enter your skills first');
                return;
            }

            showLoading(true);
            
            try {
                const token = await authenticateUser();
                const skillsArray = skills.split(',').map(s => s.trim()).filter(s => s);
                const experienceYears = parseFloat(document.getElementById('experienceYears').value) || 0;
                
                const response = await fetch(`${API_BASE}/api/resume/ats-analysis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        user_skills: skillsArray,
                        experience_years: experienceYears,
                        education: "Bachelor's",
                        certifications: [],
                        target_role: null,
                        projects_count: Math.floor(experienceYears)
                    })
                });
                
                const data = await response.json();
                displayComprehensiveResults(data);
                
            } catch (error) {
                console.error('Analysis failed:', error);
                alert('Analysis failed. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        async function analyzeSpecificRole() {
            const skills = document.getElementById('userSkills').value.trim();
            const targetRole = document.getElementById('targetRole').value;
            
            if (!skills || !targetRole) {
                alert('Please enter skills and select a target role');
                return;
            }

            showLoading(true);
            
            try {
                const token = await authenticateUser();
                const skillsArray = skills.split(',').map(s => s.trim()).filter(s => s);
                
                const response = await fetch(`${API_BASE}/api/resume/analyze-role-gap`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        role_title: targetRole,
                        user_skills: skillsArray
                    })
                });
                
                const data = await response.json();
                displayRoleGapResults(data);
                
            } catch (error) {
                console.error('Role analysis failed:', error);
                alert('Role analysis failed. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        async function uploadAndAnalyze() {
            const fileInput = document.getElementById('resumeFile');
            if (!fileInput.files[0]) {
                alert('Please select a resume file');
                return;
            }

            showLoading(true);
            
            try {
                const token = await authenticateUser();
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                const response = await fetch(`${API_BASE}/api/resume/upload-and-ats-analyze`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.status === 'parsing_failed') {
                    alert('Resume parsing failed. Please use manual skill entry.');
                    return;
                }
                
                // Auto-fill extracted skills
                if (data.resume_info && data.resume_info.extracted_skills) {
                    document.getElementById('userSkills').value = data.resume_info.extracted_skills.join(', ');
                    
                    if (data.resume_info.experience && data.resume_info.experience.years) {
                        document.getElementById('experienceYears').value = data.resume_info.experience.years;
                    }
                }
                
                displayComprehensiveResults(data);
                
            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        function displayComprehensiveResults(data) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            let html = '';
            
            // ATS Score
            if (data.ats_scoring && !data.ats_scoring.error) {
                const score = data.ats_scoring.ats_score;
                const scoreClass = score >= 80 ? 'excellent' : score >= 60 ? 'good' : score >= 40 ? 'average' : 'poor';
                
                html += `
                    <div class="score-display">
                        <div class="score-circle score-${scoreClass}">${score}%</div>
                        <div>
                            <h4>ATS Score</h4>
                            <p><strong>Category:</strong> ${data.ats_scoring.category}</p>
                            <p><strong>Recommendation:</strong> ${data.ats_scoring.recommendation}</p>
                        </div>
                    </div>
                `;
            }
            
            // Role-Based Scoring
            if (data.role_based_scoring && data.role_based_scoring.role_scores) {
                html += '<div class="role-matches"><h4>üéØ Top Role Matches</h4>';
                data.role_based_scoring.role_scores.slice(0, 5).forEach(role => {
                    html += `
                        <div class="role-match">
                            <h4>${role.role}</h4>
                            <p>Combined Score: <span class="score">${role.combined_score.toFixed(1)}%</span></p>
                            <p>Match: ${role.match_percentage.toFixed(1)}% | ATS: ${role.ats_score.toFixed(1)}% | Readiness: ${role.readiness}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Skill Importance
            if (data.skill_importance_ranking) {
                const highPriority = data.skill_importance_ranking.filter(s => s.priority === 'High');
                const mediumPriority = data.skill_importance_ranking.filter(s => s.priority === 'Medium');
                
                html += '<div class="skills-grid">';
                if (highPriority.length > 0) {
                    html += '<div class="skill-category"><h4>üî• High Priority Skills</h4>';
                    highPriority.forEach(skill => {
                        html += `<span class="skill-tag matched">${skill.skill} (${skill.importance.toFixed(3)})</span>`;
                    });
                    html += '</div>';
                }
                
                if (mediumPriority.length > 0) {
                    html += '<div class="skill-category"><h4>üìö Medium Priority Skills</h4>';
                    mediumPriority.slice(0, 10).forEach(skill => {
                        html += `<span class="skill-tag">${skill.skill} (${skill.importance.toFixed(3)})</span>`;
                    });
                    html += '</div>';
                }
                html += '</div>';
            }
            
            // Intelligent Role Matches
            if (data.intelligent_role_matches) {
                html += '<div class="role-matches"><h4>üß† AI-Powered Role Matches</h4>';
                data.intelligent_role_matches.slice(0, 3).forEach(match => {
                    html += `
                        <div class="role-match">
                            <h4>${match.role}</h4>
                            <p>AI Score: <span class="score">${match.intelligent_score.toFixed(1)}%</span></p>
                            <p>Priority Match: ${match.high_priority_match_percentage.toFixed(1)}%</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Improvement Suggestions
            if (data.improvement_suggestions && data.improvement_suggestions.length > 0) {
                html += '<div class="suggestions"><h4>üí° Improvement Suggestions</h4><ul>';
                data.improvement_suggestions.forEach(suggestion => {
                    html += `<li>${suggestion}</li>`;
                });
                html += '</ul></div>';
            }
            
            contentDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayRoleGapResults(data) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            if (data.status !== 'success') {
                contentDiv.innerHTML = `<p style="color: red;">Analysis failed: ${data.error || 'Unknown error'}</p>`;
                resultsDiv.style.display = 'block';
                return;
            }
            
            const analysis = data.analysis;
            const matchScore = analysis.match_percentage;
            const scoreClass = matchScore >= 80 ? 'excellent' : matchScore >= 60 ? 'good' : matchScore >= 40 ? 'average' : 'poor';
            
            let html = `
                <div class="score-display">
                    <div class="score-circle score-${scoreClass}">${matchScore}%</div>
                    <div>
                        <h4>Role Match for ${analysis.role_title}</h4>
                        <p><strong>Readiness:</strong> ${analysis.readiness}</p>
                        <p><strong>Matched Skills:</strong> ${analysis.total_matching_skills}/${analysis.total_required_skills}</p>
                    </div>
                </div>
            `;
            
            // Skills breakdown
            html += '<div class="skills-grid">';
            
            if (analysis.matching_skills_categorized) {
                Object.entries(analysis.matching_skills_categorized).forEach(([category, skills]) => {
                    html += `<div class="skill-category"><h4>‚úÖ ${category}</h4>`;
                    skills.forEach(skill => {
                        html += `<span class="skill-tag matched">${skill}</span>`;
                    });
                    html += '</div>';
                });
            }
            
            if (analysis.missing_skills_categorized) {
                Object.entries(analysis.missing_skills_categorized).forEach(([category, skills]) => {
                    html += `<div class="skill-category"><h4>‚ùå Missing: ${category}</h4>`;
                    skills.slice(0, 8).forEach(skill => {
                        html += `<span class="skill-tag missing">${skill}</span>`;
                    });
                    html += '</div>';
                });
            }
            
            html += '</div>';
            
            // Recommendations
            if (analysis.recommendations) {
                html += '<div class="suggestions"><h4>üí° Recommendations</h4><ul>';
                analysis.recommendations.forEach(rec => {
                    html += `<li>${rec}</li>`;
                });
                html += '</ul></div>';
            }
            
            contentDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('analyzeBtn').disabled = show;
            document.getElementById('uploadBtn').disabled = show;
            document.getElementById('roleAnalyzeBtn').disabled = show;
        }

        // Auto-load roles on page load
        window.addEventListener('load', () => {
            setTimeout(loadRoles, 1000);
        });
    </script>
</body>
</html>